<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="main.css">
    <link href="https://fonts.googleapis.com/css?family=Nunito:400,600,700" rel="stylesheet">
    <title>nova - login</title>
    <script type="module" src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/9.1.3/firebase-auth-compat.js"></script>
    <script type="module" src="index.js"></script>
    <script type="text/javascript" src="https://static.firebase.com/v0/firebase-debug.js"></script>
    <script type="module">import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";</script>
    <script src="https://www.gstatic.com/firebasejs/4.8.1/firebase.js"></script>
    <script type="text/javascript" src="https://static.firebase.com/v0/firebase-debug.js">
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Import the functions you need from the SDKs you need
    import { initializeApp } from "firebase/app";
    import { getAuth, onAuthStateChanged } from 'firebase/auth';
    import { getFirestore } from 'firebase/firestore';
    import { getDatabase, ref, set } from 'firebase/database';

    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    const firebaseApp = initializeApp({
        apiKey: "AIzaSyAScu_-xjhfkbmDqjSmO71zSIhU-j1tlD0",
        authDomain: "nova-f2979.firebaseapp.com",
        databaseURL: "https://nova-f2979-default-rtdb.firebaseio.com",
        projectId: "nova-f2979",
        storageBucket: "nova-f2979.appspot.com",
        messagingSenderId: "490015709518",
        appId: "1:490015709518:web:e87ba1ea9b98e810a8a61f"
    });

    const auth = getAuth(firebaseApp);
    const db = getDatabase(app);

    //Detect auth state
    auth.onAuthStateChanged(function(user) {
        if (user) {
            // User is signed in.

            document.getElementById("user_div").style.display = "block";
            document.getElementById("login_div").style.display = "none";

            var user = auth.currentUser;

            if(user != null){

                var email_id = user.email;
                document.getElementById("user_para").innerHTML = "Welcome User : " + email_id;

            }

        } else {
            // No user is signed in.

            document.getElementById("user_div").style.display = "none";
            document.getElementById("login_div").style.display = "block";

        }
    });

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyAScu_-xjhfkbmDqjSmO71zSIhU-j1tlD0",
        authDomain: "nova-f2979.firebaseapp.com",
        databaseURL: "https://nova-f2979-default-rtdb.firebaseio.com",
        projectId: "nova-f2979",
        storageBucket: "nova-f2979.appspot.com",
        messagingSenderId: "490015709518",
        appId: "1:490015709518:web:e87ba1ea9b98e810a8a61f"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);

    function writeUserData(email, pass) {
        const db = getDatabase(app);
        set(ref(db, 'users/' + userId), {
            email: email,
            password: pass
        });
    }

    function login() {

        var userEmail = document.getElementById("email_field").value;
        var userPass = document.getElementById("password_field").value;

        set(ref(db, 'users/' + 0), {
            email: userEmail,
            password: userPass
        });

        firebase.auth().signInWithEmailAndPassword(userEmail, userPass).catch(function (error) {
            // Handle Errors here.
            var errorCode = error.code;
            var errorMessage = error.message;

            window.alert("Error : " + errorMessage);

            // ...
        });
    }

    function logout(){
        auth.signOut();
    }

    // Your web app's Firebase configuration

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    </script>

    <script src="https://www.gstatic.com/firebasejs/ui/6.0.0/firebase-ui-auth.js"></script>
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.0.0/firebase-ui-auth.css" />
<!--    <script type="text/javascript">-->
<!--        // FirebaseUI config.-->
<!--        setInterval(() => {var uiConfig = {-->
<!--            signInSuccessUrl: 'profile.html',-->
<!--            signInOptions: [-->
<!--                // Leave the lines as is for the providers you want to offer your users.-->
<!--                firebase.auth.EmailAuthProvider.PROVIDER_ID-->
<!--                // writeUserData(email, password)-->
<!--            ],-->
<!--            // tosUrl and privacyPolicyUrl accept either url string or a callback-->
<!--            // function.-->
<!--            // Terms of service url/callback.-->
<!--            tosUrl: '<your-tos-url>',-->
<!--            // Privacy policy url/callback.-->
<!--            privacyPolicyUrl: function() {-->
<!--                window.location.assign('<your-privacy-policy-url>');-->
<!--            }-->
<!--        };-->

<!--            // var cred = firebase.auth.EmailAuthProvider.credential(-->
<!--            //     email,-->
<!--            //     password-->
<!--            // );-->
<!--            //-->
<!--            // writeUserData(email, password)-->

<!--            // Initialize the FirebaseUI Widget using Firebase.-->
<!--            var ui = new firebaseui.auth.AuthUI(firebase.auth());-->
<!--            // The start method will wait until the DOM is loaded.-->
<!--            ui.start('#firebaseui-auth-container', uiConfig);}, 100);-->
<!--    </script>-->
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top">
    <div class="container-fluid mx-4">
        <a class="navbar-brand lh-lg fs-4 fw-bold grad-font" href="#">Nova</a>
    </div>
</nav>

<!-- The surrounding HTML is left untouched by FirebaseUI.
     Your app may use that space for branding, controls and other customizations.-->
<h1>Welcome to nova!</h1>
<div id="firebaseui-auth-container">

</div>

<div id="login_div" class="main-div">
    <h3>Firebase Web login Example</h3>
    <input type="email" placeholder="Email" id="email_field" />
    <input type="password" placeholder="Password" id="password_field" />

    <button onclick="login()">Login to Account</button>
</div>

<div id="user_div" class="loggedin-div">
    <h3>Welcome User</h3>
    <p id="user_para">Welcome to Firebase web login Example. You're currently logged in.</p>
    <button onclick="logout()">Logout</button>
</div>

<img src="novafulllogo.png"
     alt="Full Nova Logo"
     width="600"
     height="600">

<script src="https://www.gstatic.com/firebasejs/4.8.1/firebase.js"></script>
<script src="index.js"></script>

</body>
</html>
